# üìù –ü–ª–∞–Ω –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ AI Telegram –ë–æ—Ç–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram-–±–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `Architecture.md`.

## –≠—Ç–∞–ø 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ü—Ä–æ–µ–∫—Ç–∞ –∏ –û–∫—Ä—É–∂–µ–Ω–∏—è

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

1.  **–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤:**
    ```
    /ai_telegram_bot
    ‚îú‚îÄ‚îÄ /core
    ‚îú‚îÄ‚îÄ /bot
    ‚îú‚îÄ‚îÄ /services
    ‚îî‚îÄ‚îÄ /storage
    ```
2.  **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
    *   `main.py`
    *   `requirements.txt`
    *   `.env`
    *   `core/__init__.py`
    *   `core/config.py`
    *   `bot/__init__.py`
    *   `bot/handlers.py`
    *   `services/__init__.py`
    *   `services/openrouter_client.py`
    *   `services/history_manager.py`
3.  **–ó–∞–ø–æ–ª–Ω–∏—Ç—å `.env`:**
    ```
    TELEGRAM_BOT_TOKEN="–í–ê–®_–¢–ï–õ–ï–ì–†–ê–ú_–¢–û–ö–ï–ù"
    OPENROUTER_API_KEY="–í–ê–®_OPENROUTER_–ö–õ–Æ–ß"
    ```
4.  **–ó–∞–ø–æ–ª–Ω–∏—Ç—å `requirements.txt`:**
    ```
    aiogram
    python-dotenv
    httpx
    ```
5.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    ```bash
    pip install -r requirements.txt
    ```

## –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è –õ–æ–≥–∏–∫–∞ –ë–æ—Ç–∞

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã.

1.  **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å `core/config.py`:**
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ `.env` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `python-dotenv`.
2.  **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å `main.py`:**
    *   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ (`aiogram`).
    *   –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.
    *   –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑ `bot/handlers.py`.
    *   –ó–∞–ø—É—Å—Ç–∏—Ç—å long polling.
3.  **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `bot/handlers.py`:**
    *   –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/start`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    *   –°–æ–∑–¥–∞—Ç—å "—ç—Ö–æ"-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–µ–º –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

## –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenRouter

**–¶–µ–ª—å:** –ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞ –∫ API OpenRouter –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤.

1.  **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `services/openrouter_client.py`:**
    *   –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `OpenRouterClient`.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `generate_response(prompt: str, history: list)`.
    *   –ú–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `https://openrouter.ai/api/v1/chat/completions` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `httpx`.
    *   –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –º–æ–¥–µ–ª—å, `prompt` –∏ `history`.
2.  **–û–±–Ω–æ–≤–∏—Ç—å `bot/handlers.py`:**
    *   –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–º–µ—Å—Ç–æ "—ç—Ö–æ", –≤—ã–∑—ã–≤–∞—Ç—å `OpenRouterClient.generate_response`.
    *   –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç OpenRouter –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

## –≠—Ç–∞–ø 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –î–∏–∞–ª–æ–≥–∞

**–¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å –±–æ—Ç–∞ "–ø–æ–º–Ω–∏—Ç—å" –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–µ.

1.  **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `services/history_manager.py`:**
    *   –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `HistoryManager`.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:
        *   `get_history(user_id)`: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        *   `add_to_history(user_id, user_message, bot_message)`: –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é.
    *   –í –∫–∞—á–µ—Å—Ç–≤–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Å–ª–æ–≤–∞—Ä—å (–¥–ª—è –Ω–∞—á–∞–ª–∞) –∏–ª–∏ Redis/SQLite (–¥–ª—è –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –≤–µ—Ä—Å–∏–∏).
2.  **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å `HistoryManager` –≤ `bot/handlers.py`:**
    *   –ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `openrouter_client`, –ø–æ–ª—É—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å –ø–æ–º–æ—â—å—é `history_manager.get_history`.
    *   –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ `openrouter_client`.
    *   –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–∞—Ä—É "–≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç" —Å –ø–æ–º–æ—â—å—é `history_manager.add_to_history`.

## –≠—Ç–∞–ø 5: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

1.  **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:**
    *   –û–±–µ—Ä–Ω—É—Ç—å –≤—ã–∑–æ–≤—ã API –≤ `try...except` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ –∏–ª–∏ –æ—à–∏–±–æ–∫ API.
2.  **–ù–∞–ø–∏—Å–∞—Ç—å `README.md`:**
    *   –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞.
    *   –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞–ø—É—Å–∫—É.
3.  **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Dockerfile:**
    *   –ù–∞–ø–∏—Å–∞—Ç—å `Dockerfile` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
